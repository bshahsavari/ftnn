function [Y,Xf,Af] = n7(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 01-May-2015 20:07:21.
% 
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 3xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1.80450172967256;-1.33405514623978;-4.5769974633592;-1.5081906789071;-1.72599357952062];
  x1_step1_gain = [0.543968033486943;0.273508963077482;0.328322155370871;0.66304613467353;0.579376431011999];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.0296326847354145;0.25301484105189542;-0.31775592852500895;-1.6121267375409869;1.5170786157586649;-0.2103482584195154;1.4099399974896694;0.092293091443875361;-0.020469278460945314;0.18683989459542008;-1.3222964411985825;-2.3972660374017973;0.17037732110937556;0.19508981492917318;2.5465533192414584;-0.75386484531414044;1.2080322616424093;0.20578879780499476;1.5654461319781725;1.9525189126812339;-0.43863903786459457;1.3287590841037347;0.97686990374573257;0.8597613041756792;-0.89617295137116959;-2.6317423224902896;-1.5470969056409323;1.2588926770020537;-1.8227245767817863;-0.45223669647371062];
  IW1_1 = [0.47650855366584499 -1.7412498543194341 1.1935555689864756 -2.370896824700762 -0.029174634732112004;-0.94895465425949477 -2.0626825132537401 1.9079672285644789 1.1293205500861203 1.3564033027131743;-0.067062658662394553 -0.78051167975393365 -0.84927789684101562 -1.7237984135870474 -0.17850937598760852;1.0428959490274494 -2.1253035122927812 -1.0066867345620929 2.1114811393493711 0.062504650050865029;-0.19741508177741462 0.76796838185683769 2.4929376085655783 -0.12796099014430115 -1.7957111841670443;-0.03674176857627897 -0.64964245836250278 -0.51969492196048506 -1.0165442096944568 -0.084229552853896578;0.038356802724363932 1.1943364648050199 3.0457290487994646 -0.090209114603787235 -1.5860168729972814;-0.0015715691088996064 0.46235526231275209 0.59687670576438068 -0.20925328849797309 -0.022307072972277932;0.67497244671147483 2.2810829981806817 -1.7572205402213221 -1.0054097331562262 -1.188950042325658;0.23877079730002798 1.3082693652206061 -0.58948039246116413 0.10933495137487698 2.1113863625380507;2.3982635507158201 -0.37817091920882989 -0.55950852514607052 0.28809399542774505 0.55295831007046192;0.79036550425377405 1.4408377845276885 -2.279613566537559 0.44060330665763986 -0.17792353224583765;0.6349385885940142 -1.3005346521845877 -0.93482333335120749 0.26252346290108264 -1.7282310701424861;-0.06879506158174277 -1.0341560862590671 -0.25173881293330269 -0.011614686615005771 -1.4212194953420794;-1.0309728970872618 2.7684253813436457 0.055685624488805291 -1.7621100603658706 -0.22182073032469204;0.48090684143527895 -0.82534944346003403 0.98481485288885384 3.1871327065658814 0.48704852863841719;-1.2507099196157556 2.6263945022991 0.97757887260503029 -0.11292821763210313 -0.5060050628403836;1.3508969401745972 -1.0379074472708989 -0.13865222024368687 0.40949980938590952 -0.3439742812353046;0.7952845807525768 1.0462657811576483 -0.94319792235151567 0.085816844290850278 2.1124286427385832;-0.9106486907591248 3.2864856797681328 0.50918275265255353 -0.11533158965465887 -3.2494949157058493;-1.5686189786333484 0.0055064997146943668 0.19776557439002079 -0.13113909269125856 -0.91693882208742294;-0.27285069080890895 1.3778530493075147 -0.019323913799313919 0.08560833465745718 -1.4997432063027492;0.34775978006396302 -0.23693784689214914 -1.560839198548827 0.24161069192273965 -1.1397917022255615;0.58469332990689016 -0.15024676372392362 0.50371065901027079 -0.21081158516128065 1.155585139635227;-0.16480179922245725 -1.7976432010155141 0.49568964657875203 0.12855918090688567 -0.33072605831689267;1.1485004398856684 -3.1370459019555428 -0.49230566156999778 2.0245966594662708 0.23406730529445488;-0.44714591764477563 -0.55031012387521128 -0.61515885217232236 0.26580326351304312 -1.6304668227193475;-1.5246263788048271 2.1196009172402692 0.65054928426651004 -0.12016284329156279 -1.1115823456906191;-0.18176474214376806 1.0107300046646344 -1.7280575354354151 1.5070923147287931 -0.42578821978051656;-0.54817775316651363 1.349047279845041 0.42966905238190639 0.080637355997536284 -0.56474321238029412];
  
  % Layer 2
  b2 = [-0.75040127974889947;-1.4525972008526071;0.57869759394187825];
  LW2_1 = [0.4141384718055689 -0.84797680131713804 -0.34665899169466846 0.21955796927330931 -0.015135824185731775 0.65653706354729624 -0.049244961779762078 0.54188891422212115 -0.95289479061813365 0.24179957877736749 0.58964940779391595 -0.69952383239143789 -0.9365122753154399 0.53577503941129501 -0.54934029324572065 -0.092360611043715013 -0.51902627401152579 0.6591574651820129 0.15259616810028576 -0.36420553381695647 -0.68523047103755752 0.51168187926368947 0.47619584951393917 -0.49068824164055219 0.57710358069308998 -0.60700578721954845 -0.76796763682392954 1.2707917088496044 0.86239003942835202 0.47551685940770194;-0.75258016312474652 1.3237291848631012 0.93036066560196717 -0.23269100537430312 -1.6992369548503454 -2.1046251917178611 1.1292672410919433 3.2008565641750595 1.6063227765678614 1.2057609592531677 0.019647595539639816 1.2744020372010396 -0.76966096130284434 2.0440888444882162 1.3732653541178539 0.12623474115224509 -1.2108052275749246 -0.1051553337910511 0.57300553826819212 -0.21444516541589873 0.13834630868256242 0.49156833740838113 0.45268198361297651 -3.3698655790727128 0.40412314693232476 1.1774596040080985 -1.9208943009196122 0.96262858398897955 -1.6336067919948485 -2.389942130911654;0.46523042410267046 -0.80931178580861485 -0.074574426446359351 0.08783322401673381 0.65204853180290889 0.18594023064578868 -0.46196024563232246 -0.23966176929836255 -0.97755694431582063 -0.53995383252391116 -0.021555590204566495 -0.64329042176074214 0.43967871035892003 -0.75373310872410271 -0.79912826557459793 -0.025918216448915069 0.6589082350972002 0.027710457924682103 -0.29857156138868007 0.12241719404214382 -0.056832740849844195 -0.52316666821533375 -0.16323718292831282 1.5055425030220118 -0.074679171247850853 -0.74100543691645104 0.93215481856848847 -0.54063623204838063 0.92686232010521341 0.80056644063746918];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = [0.0543851666610474;0.0273478764820558;0.0328234304536777];
  y1_step1_xoffset = [-18.0509538875021;-13.3433285742553;-45.7739809490106];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
